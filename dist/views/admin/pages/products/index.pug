extends ../../layouts/layouts.pug
include ../../mixins/btn-redirect.mixin.pug

block header
    h1 Danh sách sản phẩm

block hb
    sl-button(variant="primary" size="small" btn-export-excel) Xuất file Excel
    - if(ROLE.permission.includes("products-create"))
        +btn-redirect(`/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.CREATE}`)
    - if(ROLE.permission.includes("products-update"))
        sl-dropdown(link = `/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.CHANGE_STATUS_MANY_PRODUCT}`)
            sl-button(slot="trigger", caret variant="primary" size="small")
                sl-icon(slot="prefix", name="pen")
                | Hành động
            sl-menu
                sl-menu-item(value="trash-product")
                    | Xóa sản phẩm
                    sl-icon(slot="prefix", name="trash")
                sl-divider
                sl-menu-item
                    | Cập nhật trạng thái
                    sl-icon(slot="prefix", name="arrow-clockwise")
                    sl-menu(slot="submenu")
                        sl-menu-item(value="active") Hoạt động
                        sl-menu-item(value="inactive") Tạm dừng


block css
    - if(ROLE.permission.includes("products-view"))
        script(src="https://cdn.jsdelivr.net/npm/axios@1.7.9/dist/axios.min.js") 
        link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/viewerjs@1.11.7/dist/viewer.min.css")
        link(rel="stylesheet", href="/admin/css/products/index.css")

block script
    - if(ROLE.permission.includes("products-view"))
        script(src="https://cdn.jsdelivr.net/npm/sweetalert2@11")
        script(src="https://cdn.jsdelivr.net/npm/viewerjs@1.11.7/dist/viewer.min.js")
        script(src="/admin/js/products/index.js")

block main
    - if(ROLE.permission.includes("products-view"))
        sl-details(summary="Danh sách sản phẩm" open)
            - if(products && products.length > 0)
                table(class=`w-full`)
                    thead
                        tr
                            th
                                sl-checkbox()
                            th
                                div(class=``) Tên sản phẩm
                            th
                                sl-icon(name="images" class=`text-[20px]`)
                            th
                                div(class=``) Giá
                            th
                                div(class=``) Trạng thái
                            th
                                div(class=``) Vị trí
                            th 
                                div(class=``) Tạo bởi
                    tbody
                        each it in products
                            tr(class=`group`)
                                td
                                    sl-checkbox(value=it._id class=`flex justify-center`)
                                td(class=``)
                                    div(class=`flex flex-col gap-y-[5px] justify-center`) 
                                        div(class=`font-bold text-[18px] line-clamp-1` name-product) #{it.name}
                                        div(class=`opacity-0 group-hover:opacity-[100%] flex items-center gap-x-[10px] text-[14px]`)
                                            - if(ROLE.permission.includes("products-update"))
                                                a(href=`/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.UPDATE}/${it._id}`) Chỉnh sửa
                                            - if(ROLE.permission.includes("products-delete"))
                                                button(trash=`/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.TRASH}/${it._id}`) Xóa
                                td
                                    div(class=`flex items-center justify-center gap-x-[5px] `) 
                                        - if(!it.images || it.images.length == 0)
                                            sl-badge(variant="danger" size="small" pill) Chưa tạo

                                        - else if(it.images && it.images.length > 0)
                                            div(class="avatar-group")
                                                each img, i in it.images
                                                    - if(i + 1 <= 3)
                                                        sl-avatar(image=img.path, label=img.name)
                                                - if(it.images.length > 3)
                                                    sl-avatar(label="Avatar with an image icon")
                                                        sl-icon(slot="icon", name="cloud-arrow-up")
                                td
                                    div(class=`flex items-center justify-center gap-x-[5px] `) 
                                        - if(!it.priceNew)
                                            sl-badge(variant="danger" size="small" pill) Chưa tạo
                                        - else if(it.priceNew.length > 1)
                                            sl-format-number(value=Math.min(...it.priceNew))
                                            p -
                                            sl-format-number(value=Math.max(...it.priceNew))
                                        - else
                                            sl-format-number(value=Math.min(...it.priceNew))
                                td
                                    div(class=`flex justify-center items-center`)
                                        - if(it.status == 'active')
                                            sl-button(variant="success" size="small" pill change-status = `/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.CHANGE_STATUS}/${it._id}`) Hoạt động
                                        - else if(it.status == 'inactive')
                                            sl-button(variant="danger" size="small" pill change-status = `/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.CHANGE_STATUS}/${it._id}`) Tạm dừng
                                td
                                    div #{it.position}
                                td
                                    div(class=`flex items-center justify-center gap-x-[5px] `) 
                                        sl-badge(variant="primary" pill) #{it.author}
            - else
                +btn-redirect(`/${ROUTERS.ADMIN.AUTH}${ROUTERS.ADMIN.PRODUCT.PATH}${ROUTERS.ADMIN.PRODUCT.CREATE}`)

